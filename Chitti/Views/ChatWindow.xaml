<Window x:Class="Chitti.Views.ChatWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:converters="clr-namespace:Chitti.Converters"        
        xmlns:local="clr-namespace:Chitti.Views"
        Title="Chat with Chitti" Height="450" Width="400"
        WindowStyle="None" AllowsTransparency="True"
        Background="#F0F0F0" BorderBrush="#CCCCCC" BorderThickness="1">
    
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
        <!-- Add the missing converters -->
        <Style x:Key="ChatMessageStyle" TargetType="Border">
            <Setter Property="Margin" Value="5"/>
            <Setter Property="Padding" Value="10"/>
            <Setter Property="CornerRadius" Value="10"/>
        </Style>

        <!-- Background converter for user/bot messages -->
        <SolidColorBrush x:Key="UserMessageBackground" Color="#DCF8C6"/>
        <SolidColorBrush x:Key="BotMessageBackground" Color="#E8E8E8"/>

        <converters:ChatMessageBackgroundConverter x:Key="BackgroundConverter" 
        UserBackground="{StaticResource UserMessageBackground}"
        BotBackground="{StaticResource BotMessageBackground}"/>

        <converters:ChatMessageAlignmentConverter x:Key="AlignmentConverter"/>
        <converters:ChatMessageForegroundConverter x:Key="ForegroundConverter"/>
    </Window.Resources>

    
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Title Bar with mouse drag support -->
        <Grid Grid.Row="0" Background="Transparent" Height="30" MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                <Image Source="/Assets/logo.png" Width="20" Height="20" Margin="5,0"/>
                <TextBlock Text="Chat with Chitti" VerticalAlignment="Center"/>
            </StackPanel>
            <Button Content="âœ•" HorizontalAlignment="Right" Width="30" Click="CloseButton_Click"
                    Background="Transparent" BorderThickness="0" Foreground="#444444"/>
        </Grid>

        <!-- Chat Messages -->
        <ListView x:Name="ChatList" Grid.Row="1" Margin="0,10" 
                  Background="Transparent" BorderThickness="0"
                  ScrollViewer.HorizontalScrollBarVisibility="Disabled">
            <ListView.ItemTemplate>
                <DataTemplate>
                    <Border Background="{Binding IsUser, Converter={StaticResource BackgroundConverter}}"
                            CornerRadius="10" Margin="5" Padding="10"
                            HorizontalAlignment="{Binding IsUser, Converter={StaticResource AlignmentConverter}}">
                        <StackPanel>
                            <TextBlock Text="{Binding Content}" TextWrapping="Wrap"
                                     Foreground="{Binding IsError, Converter={StaticResource ForegroundConverter}}"/>
                            <TextBlock Text="{Binding Timestamp, StringFormat=HH:mm}"
                                     FontSize="10" Opacity="0.7" Margin="0,5,0,0"/>
                        </StackPanel>
                    </Border>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>

        <!-- Input Area -->
        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <TextBox x:Name="MessageInput" Height="50" Margin="0,0,10,0"
                     TextWrapping="Wrap" AcceptsReturn="True"
                     VerticalContentAlignment="Center" Padding="5"
                     KeyDown="MessageInput_KeyDown"/>
            
            <Button x:Name="SendButton" Grid.Column="1" Content="Send"
                    Width="60" Height="30" Click="SendButton_Click"/>
        </Grid>
    </Grid>
</Window>